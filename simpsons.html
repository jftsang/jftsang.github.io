<h1>Interactive Simpson's paradox demo</h1>

<p>Bart, Lisa and Maggie each sit tests in English and Math, but the
number of marks available in each test is different for each student.
</p>

<p>For each student, two percentage scores are calculated: the
    <em>weighted overall</em>, which takes into account the weightings,
    and the <em>average percentage</em>, which is the unweighted mean of the two
    percentage marks from the tests.</p>

<table>
    <thead>
        <tr>
            <th>Name</th>
            <th>English</th>
            <th>Math</th>
            <th>Weighted Overall</th>
            <th>Average Percentage</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>Bart</td>
            <td>
                <input id="bartEnglishMark" type="number" value="496"> /
                <input id="bartEnglishTotal" type="number" value="990">
                =
                <span id="bartEnglishPercentage"></span>
            </td>
            <td>
                <input id="bartMathMark" type="number" value="7"> /
                <input id="bartMathTotal" type="number" value="10">
                =
                <span id="bartMathPercentage"></span>
            </td>
            <td><span id="bartOverall"></span></td>
            <td><span id="bartAvgPerc"></span></td>
        </tr>

        <tr>
            <td>Lisa</td>
            <td>
                <input id="lisaEnglishMark" type="number" value="240"> /
                <input id="lisaEnglishTotal" type="number" value="500">
                =
                <span id="lisaEnglishPercentage"></span>
            </td>
            <td>
                <input id="lisaMathMark" type="number" value="330"> /
                <input id="lisaMathTotal" type="number" value="500">
                =
                <span id="lisaMathPercentage"></span>
            </td>
            <td><span id="lisaOverall"></span></td>
            <td><span id="lisaAvgPerc"></span></td>
        </tr>

        <tr>
            <td>Maggie</td>
            <td>
                <input id="maggieEnglishMark" type="number" value="4"> /
                <input id="maggieEnglishTotal" type="number" value="10">
                =
                <span id="maggieEnglishPercentage"></span>
            </td>
            <td>
                <input id="maggieMathMark" type="number" value="598"> /
                <input id="maggieMathTotal" type="number" value="990">
                =
                <span id="maggieMathPercentage"></span>
            </td>
            <td><span id="maggieOverall"></span></td>
            <td><span id="maggieAvgPerc"></span></td>
        </tr>

        <tr>
            <td>Class</td>
            <td><span id="classEnglish"></span></td>
            <td><span id="classMath"></span></td>
            <td><span id="classOverall"></span></td>
            <td><span id="classAvgPerc"></span></td>
        </tr>

    </tbody>

</table>

<style>
    input {
        width: 5em;
    }
    table, th, td {
        /*border: 1px solid;*/
        padding: 5px;
    }
    td {
        text-align: right;
    }
</style>

<script>
    function updateNumbers() {

        const bartEnglishMark = parseInt(document.getElementById('bartEnglishMark').value);
        const bartEnglishTotal = parseInt(document.getElementById('bartEnglishTotal').value);
        const bartEnglishPercentage = bartEnglishMark / bartEnglishTotal * 100;
        document.getElementById('bartEnglishPercentage')
            .innerText = `${bartEnglishPercentage.toFixed(1)}%`;
        const bartMathMark = parseInt(document.getElementById('bartMathMark').value);
        const bartMathTotal = parseInt(document.getElementById('bartMathTotal').value);
        const bartMathPercentage = bartMathMark / bartMathTotal * 100;
        document.getElementById('bartMathPercentage')
            .innerText = `${bartMathPercentage.toFixed(1)}%`;
        const bartOverallMark = bartEnglishMark + bartMathMark;
        const bartOverallTotal = bartEnglishTotal + bartMathTotal;
        const bartOverallPercentage = bartOverallMark / bartOverallTotal * 100;
        document.getElementById('bartOverall')
            .innerText = `${bartOverallMark} / ${bartOverallTotal} = ${(bartOverallPercentage).toFixed(1)}%`;
        document.getElementById('bartAvgPerc')
            .innerText = `${((bartEnglishPercentage + bartMathPercentage)*0.5).toFixed(1)}%`;

        const lisaEnglishMark = parseInt(document.getElementById('lisaEnglishMark').value);
        const lisaEnglishTotal = parseInt(document.getElementById('lisaEnglishTotal').value);
        const lisaEnglishPercentage = lisaEnglishMark / lisaEnglishTotal * 100;
        document.getElementById('lisaEnglishPercentage')
            .innerText = `${lisaEnglishPercentage.toFixed(1)}%`;
        const lisaMathMark = parseInt(document.getElementById('lisaMathMark').value);
        const lisaMathTotal = parseInt(document.getElementById('lisaMathTotal').value);
        const lisaMathPercentage = lisaMathMark / lisaMathTotal * 100;
        document.getElementById('lisaMathPercentage')
            .innerText = `${lisaMathPercentage.toFixed(1)}%`;
        const lisaOverallMark = lisaEnglishMark + lisaMathMark;
        const lisaOverallTotal = lisaEnglishTotal + lisaMathTotal;
        const lisaOverallPercentage = lisaOverallMark / lisaOverallTotal * 100;
        document.getElementById('lisaOverall')
            .innerText = `${lisaOverallMark} / ${lisaOverallTotal} = ${(lisaOverallPercentage).toFixed(1)}%`;
        document.getElementById('lisaAvgPerc')
            .innerText = `${((lisaEnglishPercentage + lisaMathPercentage)*0.5).toFixed(1)}%`;

        const maggieEnglishMark = parseInt(document.getElementById('maggieEnglishMark').value);
        const maggieEnglishTotal = parseInt(document.getElementById('maggieEnglishTotal').value);
        const maggieEnglishPercentage = maggieEnglishMark / maggieEnglishTotal * 100;
        document.getElementById('maggieEnglishPercentage')
            .innerText = `${maggieEnglishPercentage.toFixed(1)}%`;
        const maggieMathMark = parseInt(document.getElementById('maggieMathMark').value);
        const maggieMathTotal = parseInt(document.getElementById('maggieMathTotal').value);
        const maggieMathPercentage = maggieMathMark / maggieMathTotal * 100;
        document.getElementById('maggieMathPercentage')
            .innerText = `${maggieMathPercentage.toFixed(1)}%`;
        const maggieOverallMark = maggieEnglishMark + maggieMathMark;
        const maggieOverallTotal = maggieEnglishTotal + maggieMathTotal;
        const maggieOverallPercentage = maggieOverallMark / maggieOverallTotal * 100;
        document.getElementById('maggieOverall')
            .innerText = `${maggieOverallMark} / ${maggieOverallTotal} = ${(maggieOverallPercentage).toFixed(1)}%`;
        document.getElementById('maggieAvgPerc')
            .innerText = `${((maggieEnglishPercentage + maggieMathPercentage)*0.5).toFixed(1)}%`;

        const classEnglishMark = bartEnglishMark + lisaEnglishMark + maggieEnglishMark;
        const classEnglishTotal = bartEnglishTotal + lisaEnglishTotal + maggieEnglishTotal;
        const classEnglishPercentage = classEnglishMark / classEnglishTotal * 100;
        document.getElementById('classEnglish')
            .innerText = `${classEnglishMark} / ${classEnglishTotal} = ${classEnglishPercentage.toFixed(1)}%`

        const classMathMark = bartMathMark + lisaMathMark + maggieMathMark;
        const classMathTotal = bartMathTotal + lisaMathTotal + maggieMathTotal;
        const classMathPercentage = classMathMark / classMathTotal * 100;
        document.getElementById('classMath')
            .innerText = `${classMathMark} / ${classMathTotal} = ${classMathPercentage.toFixed(1)}%`

        const classOverallMark = classEnglishMark + classMathMark;
        const classOverallTotal = classEnglishTotal + classMathTotal;
        const classOverallPercentage = classOverallMark / classOverallTotal * 100;
        document.getElementById('classOverall')
            .innerText = `${classOverallMark} / ${classOverallTotal} = ${(classOverallPercentage).toFixed(1)}%`;
        document.getElementById('classAvgPerc')
            .innerText = `${((classEnglishPercentage + classMathPercentage)*0.5).toFixed(1)}%`;

    }

    document.querySelectorAll('input').forEach((el) => {
        el.addEventListener('input', updateNumbers)
    })

    document.addEventListener("DOMContentLoaded", updateNumbers);
</script>
